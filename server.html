<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Server – Order Entry</title>
<style>
  body { font-family:Arial; background:#0b4f20; margin:0; color:white; }
  .topbar {
    display:flex; justify-content:flex-end; gap:15px;
    background:#093d18; padding:12px;
  }
  .navbtn {
    background:white; color:black; padding:8px 14px;
    border-radius:6px; text-decoration:none;
  }
  .card {
    background:white; color:black; max-width:700px;
    margin:30px auto; padding:30px; border-radius:16px;
  }
  input, select {
    width:95%; padding:10px; margin-top:10px;
    border-radius:6px; border:1px solid #ccc;
  }
  .btn {
    background:#0b4f20; color:white; padding:10px;
    margin-top:15px; width:100%; border-radius:10px;
    text-align:center; text-decoration:none; display:block;
  }
</style>
</head>
<body>

<div class="topbar">
  <a class="navbtn" href="kitchen.html">Open Ticket Board</a>
  <a class="navbtn" href="manager.html">Manager Dashboard</a>
  <a class="navbtn" href="index.html">Logout</a>
</div>

<div class="card">
  <h2>Server Order Entry</h2>
  <p id="serverName"></p>

  <label>Table Number:</label>
  <input type="text" id="tableNum">

  <label>Notes / Allergies:</label>
  <input type="text" id="note">

  <h3>Menu Items</h3>
  <div id="menuList"></div>

  <h3>Subtotal: $<span id="subtotal">0.00</span></h3>

  <a class="btn" onclick="submitOrder()">Submit to Kitchen</a>
</div>

<script>
  document.getElementById("serverName").innerHTML =
    "Server: " + (localStorage.getItem("username") || "");

  function loadMenu() {
    let menu = JSON.parse(localStorage.getItem("menu") || "[]");
    if (menu.length === 0) {
      return document.getElementById("menuList").innerHTML =
        "<p>No menu items found. Manager must create menu first.</p>";
    }

    let html = "";
    menu.forEach((item, idx) => {
      html += `
        <div>
          <label>${item.name} – $${item.price}</label>
          <input type="number" id="qty${idx}" min="0" value="0">
        </div>
      `;
    });
    document.getElementById("menuList").innerHTML = html;

    setInterval(updateSubtotal, 500);
  }

  function updateSubtotal() {
    let menu = JSON.parse(localStorage.getItem("menu") || "[]");
    let subtotal = 0;
    menu.forEach((item, idx) => {
      const qty = Number(document.getElementById("qty"+idx)?.value || 0);
      subtotal += qty * Number(item.price);
    });
    document.getElementById("subtotal").innerText = subtotal.toFixed(2);
  }

  function submitOrder() {
    let menu = JSON.parse(localStorage.getItem("menu") || "[]");
    let items = [];
    menu.forEach((item, idx) => {
      const qty = Number(document.getElementById("qty"+idx)?.value || 0);
      if (qty > 0) items.push({ name:item.name, qty });
    });

    if (items.length === 0) return alert("Add at least one item.");

    const ticket = {
      id: Date.now(),
      server: localStorage.getItem("username"),
      table: document.getElementById("tableNum").value,
      note: document.getElementById("note").value,
      items,
      subtotal: Number(document.getElementById("subtotal").innerText),
      status: "new"
    };

    const tickets = JSON.parse(localStorage.getItem("tickets") || "[]");
    tickets.push(ticket);
    localStorage.setItem("tickets", JSON.stringify(tickets));

    alert("Order sent to kitchen!");
  }

  loadMenu();
</script>

</body>
</html>
