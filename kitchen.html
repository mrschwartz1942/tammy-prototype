<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kitchen Ticket Board</title>
<style>
  body { background:#0b4f20; font-family:Arial; margin:0; color:white; }
  .topbar {
    display:flex; justify-content:flex-end; gap:15px;
    background:#093d18; padding:12px;
  }
  .navbtn {
    background:white; color:black; padding:8px 14px;
    border-radius:6px; text-decoration:none;
  }
  .columns {
    display:flex; justify-content:space-around;
    margin-top:30px;
  }
  .col {
    width:30%; background:white; color:black;
    padding:15px; border-radius:14px;
  }
  .ticket {
    background:#eee; margin:10px 0; padding:10px;
    border-radius:8px;
  }
  .btn { background:#0b4f20; color:white; padding:8px;
    display:block; text-align:center; border-radius:6px; text-decoration:none;
    margin-top:6px;
  }
</style>
</head>
<body>

<div class="topbar">
  <a class="navbtn" href="server.html">Open Server App</a>
  <a class="navbtn" href="manager.html">Manager Dashboard</a>
  <a class="navbtn" href="index.html">Logout</a>
</div>

<h2 style="text-align:center;">Kitchen Ticket Board</h2>

<div class="columns">
  <div class="col" id="newCol"><h3>New</h3></div>
  <div class="col" id="progCol"><h3>In Progress</h3></div>
  <div class="col" id="readyCol"><h3>Ready</h3></div>
</div>

<script>
/* -----------------------------------------
   PRELOAD DEFAULT MENU (NEWLY ADDED)
----------------------------------------- */
function preloadMenu() {
  let existing = JSON.parse(localStorage.getItem("menu") || "[]");

  if (existing.length === 0) {
    const defaultMenu = [
      { name: "Crispy Potatoes", price: 7.99 },
      { name: "Garlic Shrimp", price: 12.49 },
      { name: "Beef Meatballs", price: 9.99 },
      { name: "Ham & Cheese Croquettes", price: 8.49 },
      { name: "Spanish Omelette", price: 7.49 },
      { name: "House Sangria", price: 8.00 },
      { name: "Red Wine", price: 9.00 },
      { name: "Sparkling Water", price: 3.99 },
      { name: "Churros with Chocolate", price: 6.49 },
      { name: "Caramel Flan", price: 5.99 }
    ];
    localStorage.setItem("menu", JSON.stringify(defaultMenu));
  }
}
preloadMenu();

/* -----------------------------------------
   EXISTING KITCHEN PAGE JAVASCRIPT
----------------------------------------- */

function loadTickets() {
  return JSON.parse(localStorage.getItem("tickets") || "[]");
}

function saveTickets(arr) {
  localStorage.setItem("tickets", JSON.stringify(arr));
}

function render() {
  const t = loadTickets();
  document.getElementById("newCol").innerHTML = "<h3>New</h3>";
  document.getElementById("progCol").innerHTML = "<h3>In Progress</h3>";
  document.getElementById("readyCol").innerHTML = "<h3>Ready</h3>";

  t.forEach(ticket => {
    const card = document.createElement("div");
    card.className = "ticket";
    card.innerHTML = `
      <p><b>Table:</b> ${ticket.table}</p>
      <p><b>Server:</b> ${ticket.server}</p>
      <p><b>Items:</b> ${ticket.items.map(i=> `${i.qty}Ã— ${i.name}`).join(", ")}</p>
      <p><b>Note:</b> ${ticket.note || "None"}</p>
      <p><b>Total:</b> $${ticket.subtotal.toFixed(2)}</p>
    `;
    if (ticket.status === "new") {
      const btn = document.createElement("a");
      btn.className="btn";
      btn.innerText="Mark In Progress";
      btn.onclick=()=>{ ticket.status="progress"; saveTickets(t); render(); };
      card.appendChild(btn);
      newCol.appendChild(card);
    } else if (ticket.status === "progress") {
      const btn = document.createElement("a");
      btn.className="btn";
      btn.innerText="Mark Ready";
      btn.onclick=()=>{ ticket.status="ready"; saveTickets(t); render(); };
      card.appendChild(btn);
      progCol.appendChild(card);
    } else {
      const btn = document.createElement("a");
      btn.className="btn";
      btn.innerText="Clear Ticket";
      btn.onclick=()=>{ 
        const filtered = t.filter(x=>x.id !== ticket.id);
        saveTickets(filtered);
        render();
      };
      card.appendChild(btn);
      readyCol.appendChild(card);
    }
  });
}

render();
</script>

</body>
</html>
